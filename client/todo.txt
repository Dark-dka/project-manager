1. refactor dnd code